---
- hosts: all
  remote_user: ec2-user

  tasks:
  - name: Copy Elasticsearch repo
    copy:
     src: elasticsearch.repo
     dest: /etc/yum.repos.d/elasticsearch.repo
     owner: ec2-user
     group: ec2-user
     mode: 0644
    become: true

  - name: Install Elasticsearch
    yum: 
     name: elasticsearch
     state: present
    become: true

  - name: Update the config file to allow outside access
    lineinfile:
     destfile: /etc/elasticsearch/elasticsearch.yml
     regexp: 'network.host:'
     line: 'network.host: 0.0.0.0'

  - name: Update the port in config file 
    lineinfile:
     destfile: /etc/elasticsearch/elasticsearch.yml
     regexp: 'http.port:'
     line: 'http.port: 9200'

  - name: Start Elasticsearch
    service:
     name: elasticsearch
     state: started